<script>
    // Define the GitHub API URL for the clients directory
    const apiUrl = "https://api.github.com/repos/Radilovk/client-data-system/contents/clients/";

    // GitHub Personal Access Token
    const apiKey = "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"; // Replace with your valid token
    const encodedAuth = `Bearer ${apiKey}`;

    // Function for Base64 encoding with UTF-8 support
    function utf8ToBase64(str) {
        return btoa(unescape(encodeURIComponent(str)));
    }

    document.getElementById("questionnaire").addEventListener("submit", async (event) => {
        event.preventDefault();

        // Gather form data
        const name = document.getElementById("name").value;
        const age = document.getElementById("age").value;
        const preferences = document.getElementById("preferences").value;
        const goals = document.getElementById("goals").value;

        // Create a new client object
        const newClient = {
            id: `client_${Date.now()}`, // Unique ID for the client
            name,
            age,
            preferences,
            goals,
            history: [] // Empty history for new clients
        };

        try {
            // Convert the client data to JSON and encode as Base64
            const jsonContent = JSON.stringify(newClient, null, 2);
            const base64Content = utf8ToBase64(jsonContent);

            // Send the request to create a new JSON file in the clients directory
            const response = await fetch(`${apiUrl}${newClient.id}.json`, {
                method: "PUT",
                headers: {
                    Authorization: encodedAuth,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: `Create new client file for ${newClient.name}`,
                    content: base64Content
                })
            });

            if (response.ok) {
                alert("Client data saved successfully!");
                document.getElementById("questionnaire").reset();
                window.location.href = "profile.html"; // Redirect to profile page
            } else {
                const errorDetails = await response.text();
                throw new Error(`Failed to save client data: ${errorDetails}`);
            }
        } catch (error) {
            console.error("Error details:", error);
            alert(`An error occurred: ${error.message}`);
        }
    });
</script>
