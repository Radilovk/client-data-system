<script>
    document.getElementById("questionnaire").addEventListener("submit", async (event) => {
        event.preventDefault();

        const name = document.getElementById("name").value;
        const age = document.getElementById("age").value;
        const preferences = document.getElementById("preferences").value;
        const goals = document.getElementById("goals").value;

        const newClient = {
            id: `client_${Date.now()}`,
            name,
            age,
            preferences,
            goals,
            history: []
        };

        try {
            const base64Data = btoa(unescape(encodeURIComponent(JSON.stringify(newClient, null, 2))));

            const response = await fetch(`https://api.github.com/repos/Radilovk/client-data-system/actions/workflows/upload-client.yml/dispatches`, {
                method: "POST",
                headers: {
                    Authorization: `Bearer ${process.env.MY_GITHUB_TOKEN}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    ref: "main",
                    inputs: {
                        client_id: newClient.id,
                        client_data: base64Data
                    }
                })
            });

            if (response.ok) {
                alert("Client data submitted successfully!");
                document.getElementById("questionnaire").reset();
            } else {
                const errorDetails = await response.text();
                throw new Error(`Failed to dispatch workflow: ${errorDetails}`);
            }
        } catch (error) {
            console.error("Error:", error);
            alert(`An error occurred: ${error.message}`);
        }
    });
</script>
